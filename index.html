<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Nexor Payment</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ffff">
<link rel="icon" href="icons/icon-192.png">
<style>
:root{
  --bg-dark:#00111a; --bg-light:#f4ffff; --text-dark:#e0f7ff;
  --text-light:#002b36; --neon:#00eaff;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg-dark);color:var(--text-dark);display:flex;align-items:center;justify-content:center;min-height:100vh;transition:.25s}
body.light{background:var(--bg-light);color:var(--text-light)}
.container{width:94%;max-width:800px;padding:18px;background:rgba(0,0,0,.45);border-radius:16px;border:1px solid rgba(0,255,255,.12);backdrop-filter:blur(12px)}
body.light .container{background:rgba(255,255,255,.55)}
h1{text-align:center;color:var(--neon);margin-bottom:12px;font-size:24px}
.row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center}
.card{width:145px;padding:12px;border-radius:14px;background:rgba(0,15,25,.75);border:1px solid rgba(0,255,255,.18);text-align:center;transition:.23s}
body.light .card{background:rgba(255,255,255,.6)}
.card:hover{transform:scale(1.05);box-shadow:0 0 12px rgba(0,255,255,.4)}
.card h3{margin:0;color:var(--neon);font-size:16px}
.card p{margin:5px 0 7px;font-weight:600;font-size:14px}
button{width:100%;padding:7px 0;border:none;border-radius:8px;cursor:pointer;font-weight:600;background:var(--neon);color:#001017;transition:.2s}
button:active{transform:scale(.94)} button:hover{box-shadow:0 0 12px var(--neon)}
.theme-toggle{position:fixed;top:10px;right:10px;padding:7px 10px;border-radius:10px;background:rgba(0,255,255,.15);border:1px solid rgba(0,255,255,.4);cursor:pointer;font-size:14px}

/* Toast black */
#toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:#000;border:1px solid var(--neon);padding:12px 18px;border-radius:12px;color:var(--neon);display:none;box-shadow:0 0 10px rgba(0,255,255,.3);z-index:9999}

/* Loading box */
#loadingBox{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#000c;padding:18px 24px;border-radius:12px;color:var(--neon);border:1px solid var(--neon);display:none;z-index:9999}

/* Hidden QR helpers (guarantee hidden, still in DOM) */
#qrisImg, #hiddenCanvas{display:none !important; width:0 !important; height:0 !important; visibility:hidden !important; opacity:0 !important}

/* small responsive tweak */
@media(max-width:420px){
  .card{width:120px;padding:10px}
  h1{font-size:20px}
}
</style>
</head>
<body>
<button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">üåó Mode</button>

<div class="container">
  <h1>Nexor Payment</h1>
  <div class="row">
    <div class="card">
      <h3>DANA</h3>
      <p id="dana">085124833755</p>
      <button onclick="copyText('dana')">Salin</button>
    </div>

    <div class="card">
      <h3>SeaBank</h3>
      <p id="seabank">901681202793</p>
      <button onclick="copyText('seabank')">Salin</button>
    </div>

    <div class="card">
      <h3>QRIS</h3>
      <small style="opacity:.7">Tersimpan saat klik</small>
      <button onclick="downloadQR()">Simpan QR</button>
    </div>
  </div>
</div>

<div id="toast">‚úÖ Payment berhasil disalin</div>
<div id="loadingBox">‚è≥ Memproses QR...</div>

<!-- Hidden elements: keep in DOM so download works, but NOT visible -->
<img id="qrisImg" src="qris.png" alt="QRIS (hidden)">
<canvas id="hiddenCanvas" aria-hidden="true"></canvas>

<script>
// service worker register
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').catch(()=>{/*ignore*/});
}

// theme toggle (persist)
const tBtn=document.getElementById("themeToggle");
const body=document.body;
const savedTheme = localStorage.getItem('nexor-theme');
if(savedTheme==='light') body.classList.add('light');
tBtn.onclick=()=>{
  body.classList.toggle('light');
  localStorage.setItem('nexor-theme', body.classList.contains('light') ? 'light' : 'dark');
}

// toast
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent = msg || '‚úÖ Payment berhasil disalin';
  t.style.display='block';
  setTimeout(()=>t.style.display='none',2000);
}

// copy
function copyText(id){
  const text = document.getElementById(id).innerText;
  navigator.clipboard.writeText(text).then(()=> showToast('‚úÖ Payment berhasil disalin')).catch(()=> showToast('Gagal menyalin'));
}

// download QR with watermark + loading
function downloadQR(){
  const loading = document.getElementById('loadingBox');
  loading.style.display='block';

  // small delay to show loading (and simulate processing)
  setTimeout(()=>{
    const img = document.getElementById('qrisImg');
    if(!img || !img.src){ loading.style.display='none'; alert('File QR tidak ditemukan'); return; }

    // create canvas with natural size
    const canvas = document.getElementById('hiddenCanvas');
    const ctx = canvas.getContext('2d');

    // ensure img is loaded
    const tmp = new Image();
    tmp.crossOrigin = 'anonymous';
    tmp.onload = function(){
      canvas.width = tmp.naturalWidth;
      canvas.height = tmp.naturalHeight;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(tmp,0,0);

      // watermark small bottom-right
      const wmText = 'Nexor Secure';
      ctx.font = Math.max(12, Math.round(canvas.width * 0.03)) + 'px Arial';
      ctx.fillStyle = 'rgba(0,255,255,0.85)';
      ctx.textAlign = 'right';
      ctx.textBaseline = 'bottom';
      ctx.fillText(wmText, canvas.width - 10, canvas.height - 8);

      // create download link
      canvas.toBlob(function(blob){
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'qris.png';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(a.href);
        loading.style.display='none';
        // small success toast
        showToast('‚úÖ QR berhasil disimpan');
      }, 'image/png', 0.95);
    };
    tmp.onerror = function(){ loading.style.display='none'; alert('Gagal memuat QR'); };
    tmp.src = img.src + ((img.src.indexOf('?') === -1) ? '?v=' + Date.now() : '&v=' + Date.now()); // cache-bust for safety
  }, 700);
}

// anti-inspect basic
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
  if(e.key==='F12' || (e.ctrlKey && e.shiftKey && e.key==='I') || (e.ctrlKey && e.key==='U')) e.preventDefault();
});
</script>
</body>
</html>